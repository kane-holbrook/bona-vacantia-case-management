<template>
    <div class="slds-form-element slds-m-bottom_small">
        <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_left">
            <lightning-icon icon-name="utility:search" size="x-small" alternative-text="Search" class="slds-input__icon slds-input__icon_left"></lightning-icon>
            <input type="text" id="slds-input" placeholder="Search for database screen" class="slds-input" oninput={handleSearch} />
        </div>
    </div>
    <template if:true={filteredTreeData}>
        <div class="slds-tree-container">
            <h4 class="slds-tree__group-header slds-m-bottom_xxx-small" id="treeheading">{treeName} Database</h4>
            <ul class="slds-tree" role="tree">
                <template for:each={filteredTreeData} for:item="node">
                    <li key={node.label} role="treeitem" aria-level={node.level}>
                        <div class="slds-tree__item">
                            <template if:true={node.hasChildren}>
                                <button class="slds-button slds-button_icon slds-m-right_x-small" aria-hidden="true" tabindex={node.tabindex} onclick={handleToggle} onkeydown={handleKeyDown} data-label={node.label}>
                                    <lightning-icon icon-name={node.icon} alternative-text="Expand" size="x-small"></lightning-icon>
                                </button>
                            </template>
                            <span class="slds-has-flexi-truncate">
                                <span class="slds-tree__item-label slds-truncate" title={node.label} data-label={node.label} data-object={node.object} onclick={handleNavigation} onkeydown={handleKeyDown} tabindex={node.labelTabindex} role="button">
                                    {node.label}
                                </span>
                            </span>
                        </div>
                        <template if:true={node.hasChildren}>
                            <ul class={node.expandedClass}>
                                <template for:each={node.children} for:item="child">
                                    <li key={child.label} aria-level="2">
                                        <div class="slds-tree__item">
                                            <template if:true={child.hasChildren}>
                                                <button class="slds-button slds-button_icon slds-m-right_x-small" aria-hidden="true" tabindex={child.tabindex} onclick={handleToggle} onkeydown={handleKeyDown} data-label={child.label}>
                                                    <lightning-icon icon-name={child.icon} alternative-text="Expand" size="x-small"></lightning-icon>
                                                </button>
                                            </template>
                                            <span class="slds-has-flexi-truncate">
                                                <span class="slds-tree__item-label slds-truncate" title={child.label} data-label={child.label} data-object={child.object} onclick={handleNavigation} onkeydown={handleKeyDown} tabindex={child.labelTabindex} role="button" data-parent-label={node.label}>
                                                    {child.label}
                                                </span>
                                            </span>
                                        </div>
                                        <template if:true={child.hasChildren}>
                                            <ul class={child.expandedClass}>
                                                <template for:each={child.children} for:item="grandchild">
                                                    <li key={grandchild.label} aria-level="3">
                                                        <div class="slds-tree__item">
                                                            <template if:true={grandchild.hasChildren}>
                                                                <button class="slds-button slds-button_icon slds-m-right_x-small" aria-hidden="true" tabindex={grandchild.tabindex} onclick={handleToggle} onkeydown={handleKeyDown} data-label={grandchild.label}>
                                                                    <lightning-icon icon-name={grandchild.icon} alternative-text="Expand" size="x-small"></lightning-icon>
                                                                </button>
                                                            </template>
                                                            <span class="slds-has-flexi-truncate">
                                                                <span class="slds-tree__item-label slds-truncate" title={grandchild.label} data-label={grandchild.label} data-object={grandchild.object} onclick={handleNavigation} onkeydown={handleKeyDown} tabindex={grandchild.tabindex} role="button" data-parent-grandchild-label={child.label}>
                                                                    {grandchild.label}
                                                                </span>
                                                            </span>
                                                        </div>
                                                        <template if:true={grandchild.hasChildren}>
                                                            <ul class={grandchild.expandedClass}>
                                                                <template for:each={grandchild.children} for:item="greatgrandchild">
                                                                    <li key={greatgrandchild.label} aria-level="4">
                                                                        <div class="slds-tree__item">
                                                                            <template if:true={greatgrandchild.hasChildren}>
                                                                                <button class="slds-button slds-button_icon slds-m-right_x-small" aria-hidden="true" tabindex={greatgrandchild.tabindex} onclick={handleToggle} onkeydown={handleKeyDown} data-label={greatgrandchild.label}>
                                                                                    <lightning-icon icon-name={greatgrandchild.icon} alternative-text="Expand" size="x-small"></lightning-icon>
                                                                                </button>
                                                                            </template>
                                                                            <span class="slds-has-flexi-truncate">
                                                                                <span class="slds-tree__item-label slds-truncate" title={greatgrandchild.label} data-label={greatgrandchild.label} data-object={greatgrandchild.object} onclick={handleNavigation} onkeydown={handleKeyDown} tabindex={greatgrandchild.tabindex} role="button" data-parent-greatgrandchild-label={grandchild.label}>
                                                                                    {greatgrandchild.label}
                                                                                </span>
                                                                            </span>
                                                                        </div>
                                                                    </li>
                                                                </template>
                                                            </ul>
                                                        </template>
                                                    </li>
                                                </template>
                                            </ul>
                                        </template>
                                    </li>
                                </template>
                            </ul>
                        </template>
                    </li>
                </template>
            </ul>
        </div>
    </template>
    <template if:true={error}>
        <div class="slds-text-color_error">{error}</div>
    </template>
</template>
