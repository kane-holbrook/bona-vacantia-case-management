<template>
    <lightning-card title="Document Selector">
        <template if:true={isDocumentSelection}>
        <div class="slds-grid slds-wrap" style="background-color:#fafaf9; position:relative; overflow:hidden; height:600px;">
            <div class="slds-col slds-p-around_medium" style="flex-grow: 1;">
                <template if:true={isLoading}>
                    <div class="slds-align_absolute-center slds-m-around_medium">
                        <lightning-spinner alternative-text="Loading"></lightning-spinner>
                    </div>
                </template>
                <template if:false={isLoading}>
                    <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                        <thead>
                            <tr class="slds-line-height_reset">
                                <th class="" scope="col"><div class="slds-truncate" title="Select">Select</div></th>
                                <th class="" scope="col"><div class="slds-truncate" title="File Name">Document Name</div></th>
                                <th class="" scope="col"><div class="slds-truncate" title="Document Type">Document Type</div></th>
                                <th class="" scope="col"><div class="slds-truncate" title="Created">Created</div></th>
                            </tr>
                        </thead>
                        <tbody>
                            <template for:each={documents} for:item="doc">
                                <tr key={doc.DocumentID__c}>
                                    <td>
                                        <lightning-input type="radio" name="documentSelection" data-id={doc.DocumentID__c} onchange={handleSelectionChange}></lightning-input>
                                    </td>
                                    <td>
                                        <a href={doc.previewUrl} target="_blank">{doc.Name}</a>
                                    </td>
                                    <td>{doc.DocumentType__c}</td>
                                    <td>
                                        <lightning-formatted-date-time value={doc.Created_Time__c} 
                                                                        year="numeric" 
                                                                        month="2-digit" 
                                                                        day="2-digit">
                                        </lightning-formatted-date-time>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                    <div class="slds-align_absolute-center slds-m-top_medium">
                        <lightning-button variant="brand" label="Next" onclick={handleNextDocumentSelection} class="slds-m-left_x-small"></lightning-button>
                    </div>
                </template>
            </div>
        </div>
        </template>
            <div class="slds-grid slds-wrap">
                <!-- Enter bank details -->
                <template if:true={isBankDetails}>
                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="bankName" label="Bank Name" value={bankInfo.bankName} onchange={handleBankNameChange}></lightning-input>
                        <lightning-input name="addressline1" label="Address Line 1" value={bankInfo.addressLine1} onchange={handleAddressLine1Change}></lightning-input>
                        <lightning-input name="addressline2" label="Address Line 2" value={bankInfo.addressLine2} onchange={handleAddressLine2Change}></lightning-input>
                        <lightning-input name="addressline3" label="Address Line 3" value={bankInfo.addressLine3} onchange={handleAddressLine3Change}></lightning-input>
                        <lightning-input name="postcode" label="Postcode" value={bankInfo.postcode} onchange={handlePostcodeChange}></lightning-input>
                        <lightning-input name="telephone" label="Telephone" value={bankInfo.telephone} onchange={handleTelephoneChange}></lightning-input>
                        <lightning-input name="fax" label="Fax" value={bankInfo.fax} onchange={handleFaxChange}></lightning-input>
                        <lightning-input name="salutation" label="Salutation" value={bankInfo.salutation} onchange={handleSalutationChange}></lightning-input>
                    </div>

                    <div class="slds-col slds-size_1-of-2">
                        <lightning-input name="reference" label="Reference" value={bankInfo.reference} onchange={handleReferenceChange}></lightning-input>
                        <lightning-input name="accountNumber" label="Account Number" value={bankInfo.accountNumber} onchange={handleAccountNumberChange}></lightning-input>
                        <lightning-input name="sortCode" label="Sort Code" value={bankInfo.sortCode} onchange={handleSortCodeChange}></lightning-input>
                        <lightning-input name="balance" label="Balance" value={bankInfo.balance} onchange={handleBalanceChange}></lightning-input>
                        <lightning-input name="spreadsheetNumber" label="Spreadsheet Number" value={bankInfo.spreadsheetNumber} onchange={handleSpreadsheetNumberChange}></lightning-input>
                        <lightning-input name="electronicReferral" label="Electronic Referral" value={bankInfo.electronicReferral} onchange={handleElectronicReferralChange}></lightning-input>
                    </div>

                    <div class="slds-m-around_medium">
                        <lightning-button label="Next" onclick={handleBankDetailsNext}></lightning-button>
                    </div>
                </template>

                <!-- Select letter type -->
                <template if:true={isLetterTypeSelection}>
                    <div class="slds-m-around_medium">
                        <lightning-radio-group name="letterType" label="Select letter type" options={letterTypeOptions} value={letterType} onchange={handleLetterTypeChange}></lightning-radio-group>
                    </div>

                    <div class="slds-m-around_medium">
                        <lightning-button label="Next" onclick={handleLetterTypeNext}></lightning-button>
                    </div>
                </template>

                <!-- Enter date of previous letter -->
                <template if:true={isEnterDateOfPreviousLetter}>
                    <div class="slds-m-around_medium">
                        <lightning-input type="date" name="previousLetterDate" label="Enter date of previous letter" value={previousLetterDate} onchange={handlePreviousLetterDateChange}></lightning-input>
                    </div>

                    <div class="slds-m-around_medium">
                        <lightning-button label="Generate" onclick={handleGenerateDocument}></lightning-button>
                    </div>
                </template>
            </div>
            <!-- Generated document -->
            <c-pdftron-wv-instance></c-pdftron-wv-instance>
    </lightning-card>
</template>